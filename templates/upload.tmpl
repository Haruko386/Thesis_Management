<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上传论文 - PaperHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 flex items-center justify-center h-screen">

<div class="bg-white p-8 rounded-2xl shadow-sm border w-full max-w-5xl flex">

    <!-- 左侧封面展示区域 -->
    <div class="w-1/3 bg-gray-100 border-r border-gray-200 p-4 flex justify-center items-center">
        <h3 class="text-xl font-semibold mb-4 text-center">论文封面</h3>
        <div id="coverPreview" class="h-64 w-full bg-gray-300 flex items-center justify-center">
            <!-- 上传封面预览 -->
        </div>
    </div>

    <!-- 右侧论文上传信息区域 -->
    <div class="w-2/3 pl-6">
        <h2 class="text-2xl font-bold mb-6">上传新论文</h2>

        <form action="/api/upload" method="POST" enctype="multipart/form-data" class="space-y-4">

            <!-- 论文标题 -->
            <div>
                <label for="title" class="text-sm font-medium">论文标题</label>
                <input type="text" id="title" name="title" placeholder="论文标题" class="w-full border p-3 rounded-xl bg-gray-50" required>
            </div>

            <!-- 作者 -->
            <div>
                <label for="author" class="text-sm font-medium">作者</label>
                <input type="text" id="author" name="author" placeholder="作者" class="w-full border p-3 rounded-xl bg-gray-50" required>
            </div>

            <!-- 分类 -->
            <div>
                <label for="classification" class="text-sm font-medium">分类（用;隔开多个分类）</label>
                <input type="text" id="classification" name="classification" placeholder="分类" class="w-full border p-3 rounded-xl bg-gray-50" required>
            </div>

            <!-- 发表期刊 -->
            <div>
                <label for="journal" class="text-sm font-medium">发表期刊</label>
                <input type="text" id="journal" name="journal" placeholder="发表期刊" class="w-full border p-3 rounded-xl bg-gray-50" required>
            </div>

            <!-- 发布日期 -->
            <div>
                <label for="publicdate" class="text-sm font-medium">发布日期</label>
                <input type="date" id="publicdate" name="publicdate" class="w-full border p-3 rounded-xl bg-gray-50" required>
            </div>

            <!-- 文件上传 -->
            <div class="border-2 border-dashed rounded-xl p-8 text-center hover:bg-gray-50 transition cursor-pointer relative" id="fileInputContainer">
                <input type="file" name="file" id="fileInput" accept="application/pdf" class="absolute inset-0 opacity-0 cursor-pointer" required>
                <p class="text-gray-400">点击或拖拽 PDF 文件至此处</p>
            </div>
            <div id="fileNamePreview" class="mt-2 text-gray-500 hidden"></div>

            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 mt-4" id="submitButton">确认上传</button>
            <a href="/" class="block text-center text-sm text-gray-500 hover:text-blue-600 mt-2">返回首页</a>
        </form>
    </div>
</div>

<script>
    // 监听文件上传输入框变化，显示文件名和封面
    const fileInput = document.getElementById('fileInput');
    const fileNamePreview = document.getElementById('fileNamePreview');
    const coverPreview = document.getElementById('coverPreview');
    const submitButton = document.getElementById('submitButton');

    fileInput.addEventListener('change', function() {
        const file = fileInput.files[0];
        if (file) {
            // 显示文件名
            fileNamePreview.classList.remove('hidden');
            fileNamePreview.textContent = `选择的文件: ${file.name}`;

            // 生成封面预览（显示第一页PDF作为封面）
            const reader = new FileReader();
            reader.onload = function(e) {
                const pdfData = e.target.result;
                const blob = new Blob([pdfData], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const img = new Image();
                img.onload = function() {
                    coverPreview.innerHTML = ''; // 清空之前的预览
                    coverPreview.appendChild(img);
                };
                img.src = url;
            };
            reader.readAsArrayBuffer(file);

            // 显示上传按钮
            submitButton.disabled = false;
        }
    });
</script>

</body>
</html>
